import{s as e,a as t,h as n,r as o,c as s,w as a,i,o as l,b as d,d as c,j as u,t as h,f as r,I as p,k as g}from"./index-XRL4FCaQ.js";import{_ as m}from"./_plugin-vue_export-helper.BCo6x5W8.js";const b=m({data:()=>({phone:"",code:"",countdown:60,isCountingDown:!1,timer:null,isDebouncing:!1}),computed:{countDownText(){return this.isCountingDown?`${this.countdown}s`:"发送验证码"}},methods:{validatePhone(){return/^1[3-9]\d{9}$/.test(this.phone)},startCountDown(){this.isCountingDown=!0,this.timer=setInterval((()=>{this.countdown>0?this.countdown--:this.stopCountDown()}),1e3)},stopCountDown(){clearInterval(this.timer),this.isCountingDown=!1,this.countdown=60},debounce(e,t=1e3){this.isDebouncing||(this.isDebouncing=!0,e(),setTimeout((()=>{this.isDebouncing=!1}),t))},async sendCode(){this.debounce((async()=>{if(this.validatePhone()){if(!this.isCountingDown)try{const n=await t({url:"http://ebbhospital.binglang6.com/api/pushCode",method:"GET",data:{phone:this.phone}});console.log(n),200==n.data.code?(this.startCountDown(),e({title:"验证码已发送",icon:"success"})):e({title:n.data.msg||"验证码发送失败",icon:"none"})}catch(n){e({title:"验证码发送失败",icon:"none"})}}else e({title:"请输入正确的手机号",icon:"none"})}))},async handleLogin(){if(this.validatePhone())if(this.code)try{const s=await t({url:"http://ebbhospital.binglang6.com/api/login",method:"POST",data:{phone:this.phone,code:this.code}});200==s.data.code?(n("token",s.data.token),o({url:"/pages/index/index"})):e({title:s.data.msg,icon:"none"})}catch(s){e({title:"登录失败",icon:"none"})}else e({title:"请输入验证码",icon:"none"});else e({title:"请输入正确的手机号",icon:"none"})}},beforeDestroy(){this.stopCountDown(),this.isDebouncing=!1}},[["render",function(e,t,n,o,m,b){const w=r,f=i,D=p,C=g;return l(),s(f,{class:"login-container"},{default:a((()=>[d(f,{class:"header"},{default:a((()=>[d(w,{class:"welcome"},{default:a((()=>[c("欢迎登录")])),_:1}),d(w,{class:"sub-title"},{default:a((()=>[c("请使用手机号验证登录")])),_:1})])),_:1}),d(f,{class:"form"},{default:a((()=>[d(f,{class:"input-group"},{default:a((()=>[d(w,{class:"label"},{default:a((()=>[c("手机号")])),_:1}),d(D,{type:"number",modelValue:m.phone,"onUpdate:modelValue":t[0]||(t[0]=e=>m.phone=e),placeholder:"请输入手机号",maxlength:"11","placeholder-class":"placeholder"},null,8,["modelValue"])])),_:1}),d(f,{class:"input-group"},{default:a((()=>[d(w,{class:"label"},{default:a((()=>[c("验证码")])),_:1}),d(f,{class:"code-input-wrap"},{default:a((()=>[d(D,{type:"number",modelValue:m.code,"onUpdate:modelValue":t[1]||(t[1]=e=>m.code=e),placeholder:"请输入验证码",maxlength:"6","placeholder-class":"placeholder"},null,8,["modelValue"]),d(C,{disabled:m.isCountingDown,onClick:b.sendCode,class:u(["code-btn",m.isCountingDown?"disabled":""])},{default:a((()=>[c(h(b.countDownText),1)])),_:1},8,["disabled","onClick","class"])])),_:1})])),_:1})])),_:1}),d(C,{onClick:b.handleLogin,class:"login-btn"},{default:a((()=>[c("登录")])),_:1},8,["onClick"])])),_:1})}],["__scopeId","data-v-6a284652"]]);export{b as default};
